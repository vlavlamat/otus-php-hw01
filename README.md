# üê≥ –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ1 ‚Äî –û–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–∞ Docker

## ‚ú® –¶–µ–ª—å

* –ü–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è.
* –û—Å–æ–∑–Ω–∞—Ç—å –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞.
* –ù–∞—É—á–∏—Ç—å—Å—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Ä–∞–±–æ—á–µ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ PHP-–ø—Ä–æ–µ–∫—Ç–∞ —Å –ø–æ–º–æ—â—å—é Docker Compose.
* –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—É—Å–∫ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫—É –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

---

## ‚öôÔ∏è –°–æ—Å—Ç–∞–≤ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã:

* **nginx** ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏–∫—É –∏ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç PHP-–∑–∞–ø—Ä–æ—Å—ã –≤ php-fpm
* **php-fpm** ‚Äî –∏—Å–ø–æ–ª–Ω—è–µ—Ç PHP-—Å–∫—Ä–∏–ø—Ç—ã, —Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è —Å nginx —á–µ—Ä–µ–∑ unix-—Å–æ–∫–µ—Ç (–∏–ª–∏ TCP –≤ –±–∞–∑–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏)
* **postgres** ‚Äî –°–£–ë–î –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
* **redis** ‚Äî –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π
* **memcached** ‚Äî –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
* **adminer** *(—Ç–æ–ª—å–∫–æ dev)* ‚Äî web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –¥–∞–Ω–Ω—ã–µ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ —Ç–æ–º–∞.

## üõ†Ô∏è –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.env.example` –≤ `.env`:
```bash
cp .env.example .env
```
2. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env` –∏ **–¥–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ** –≤–º–µ—Å—Ç–æ –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.
   –ù–∞–ø—Ä–∏–º–µ—Ä:
```
POSTGRES_DB=otus_php_hw01
POSTGRES_USER=student
POSTGRES_PASSWORD=secret
POSTGRES_ALLOW_EMPTY_PASSWORD=no

ADMINER_DEFAULT_SERVER=postgres

NGINX_PORT=8000
```
---

> üí° **–°–æ–≤–µ—Ç:** –î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ –ø–∞–ø–∫–∏ `scripts/`:
>
> * `scripts/dev-build.sh` ‚Äî —Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
> * `scripts/dev-up.sh` ‚Äî –∑–∞–ø—É—Å–∫ –±–µ–∑ —Å–±–æ—Ä–∫–∏
> * `scripts/dev-down.sh` ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ dev-–æ–∫—Ä—É–∂–µ–Ω–∏—è
> * `scripts/prod-build.sh` ‚Äî —Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ production-–æ–∫—Ä—É–∂–µ–Ω–∏—è
> * `scripts/prod-up.sh` ‚Äî –∑–∞–ø—É—Å–∫ –±–µ–∑ —Å–±–æ—Ä–∫–∏
> * `scripts/prod-down.sh` ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ production-–æ–∫—Ä—É–∂–µ–Ω–∏—è
>
–î–ª—è —ç—Ç–æ–≥–æ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É `scripts`:
```bash
 cd scripts
```
–ò –∑–∞–ø—É—Å—Ç–∏—Ç–µ –Ω—É–∂–Ω—ã–π –≤–∞–º —Å–∫—Ä–∏–ø—Ç
```bash
./dev-build.sh   # –∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –Ω—É–∂–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
```
### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–∞–ø—É—Å–∫ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ development-—Ä–µ–∂–∏–º–µ
```bash
docker compose -f docker-compose.yml -f docker-compose.dev.yml up --build -d
```
–í –¥–∞–ª—å–Ω–µ–π—à–µ–º, –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å —Ñ–ª–∞–≥–æ–º `--build`, –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏:
```bash
docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d
```
**–û—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
docker compose -f docker-compose.yml -f docker-compose.dev.yml down
```
---
### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–∞–ø—É—Å–∫ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ production-—Ä–µ–∂–∏–º–µ
```bash
docker compose -f docker-compose.yml -f docker-compose.prod.yml up --build -d
```
–í –¥–∞–ª—å–Ω–µ–π—à–µ–º, –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å —Ñ–ª–∞–≥–æ–º `--build`, –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏:
```bash
docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d
```
**–û—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
docker compose -f docker-compose.yml -f docker-compose.prod.yml down
```
**–£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–º–æ–≤ (–ë–î –∏ –∫–µ—à):**
```bash
docker compose -f docker-compose.yml -f docker-compose.prod.yml down -v
```
---
## üìö –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

* –í dev-—Ä–µ–∂–∏–º–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Adminer –Ω–∞ –ø–æ—Ä—Ç—É 8080.
* –°–≤—è–∑—å –º–µ–∂–¥—É nginx –∏ FPM –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ —á–µ—Ä–µ–∑ unix-—Å–æ–∫–µ—Ç.
* –î–ª—è production-—Å–±–æ—Ä–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ–±—Ä–∞–∑—ã, –∑–∞—Ä–∞–Ω–µ–µ —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –∏–∑ `Dockerfile` –ø—Ä–æ–µ–∫—Ç–∞ (nginx –∏ php), –∏ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥ —Ç–µ–≥–∞–º–∏ `otus-php-hw01/nginx:latest` –∏ `otus-php-hw01/php-fpm:latest`. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å production-–æ–∫—Ä—É–∂–µ–Ω–∏–µ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
* –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ PHP (8.3-fpm), nginx, Redis, Memcached –∏ PostgreSQL.
* Composer –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ php-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.
---
## üìù –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

* –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:*PORT*, –≥–¥–µ *PORT* ‚Äî —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `NGINX_PORT` –∏–∑ –≤–∞—à–µ–≥–æ —Ñ–∞–π–ª–∞ `.env`.  
   –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –ø–æ—Ä—Ç –Ω–µ —É–∫–∞–∑–∞–Ω, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å http://localhost:8000.  
   –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (–ë–î, Redis, Memcached). 
* –û—Ç–∫—Ä–æ–π—Ç–µ [http://localhost:8080](http://localhost:8080) ‚Äî —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç Adminer (dev).
* –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏:
```bash
    docker compose logs -f
```